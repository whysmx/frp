(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3713:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ez});var a=t(5155),r=t(2115),n=t(9708),l=t(2085),d=t(2596),o=t(9688);function i(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,o.QP)((0,d.$)(s))}let c=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-all duration-300 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95 hover:scale-[1.02] [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 rounded-2xl shadow-lg shadow-primary/20 hover:shadow-xl hover:shadow-primary/25",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 rounded-2xl shadow-lg shadow-destructive/20 hover:shadow-xl hover:shadow-destructive/25",outline:"border border-border bg-background hover:bg-accent hover:text-accent-foreground rounded-xl",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 rounded-xl",ghost:"hover:bg-accent hover:text-accent-foreground rounded-xl",link:"text-primary underline-offset-4 hover:underline rounded-lg"},size:{default:"h-11 px-6 py-3",sm:"h-9 px-4 py-2 rounded-xl",lg:"h-12 px-8 py-4 rounded-2xl",icon:"h-11 w-11 rounded-2xl"}},defaultVariants:{variant:"default",size:"default"}}),m=r.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:d=!1,...o}=e,m=d?n.DX:"button";return(0,a.jsx)(m,{className:i(c({variant:r,size:l,className:t})),ref:s,...o})});m.displayName="Button";let x=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:i("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...n})});x.displayName="Input";let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});u.displayName="Card",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("flex flex-col space-y-1.5 p-6",t),...r})}).displayName="CardHeader",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("text-2xl font-semibold leading-none tracking-tight",t),...r})}).displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("p-6 pt-0",t),...r})});h.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var f=t(9613);let p=f.Kq,g=f.bL,b=f.l9,j=r.forwardRef((e,s)=>{let{className:t,sideOffset:r=4,...n}=e;return(0,a.jsx)(f.UC,{ref:s,sideOffset:r,className:i("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})});j.displayName=f.UC.displayName;var v=t(7924),N=t(1482),y=t(4616),w=t(1154),C=t(3717),k=t(7434);function A(e){let{sites:s,searchTerm:t,setSearchTerm:n,selectedTags:l,setSelectedTags:d,showTagFilter:o,setShowTagFilter:i,filteredSites:c,editMode:f,loading:A,onEditModeChange:S,onSaveChanges:E,onShowBatchImport:T,onShowConfigEditor:_}=e,R=(0,r.useMemo)(()=>{let e=new Set;return s.forEach(s=>{s.tags.forEach(s=>e.add(s))}),["无标签",...Array.from(e)]},[s]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{className:"glass-effect border-0 rounded-3xl card-hover",children:(0,a.jsx)(h,{className:"p-8",children:(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(v.A,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5"}),(0,a.jsx)(x,{placeholder:"搜索站点编号、名称或标签",value:t,onChange:e=>n(e.target.value),className:"pl-12 apple-input h-14 text-base placeholder:text-muted-foreground"})]}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)(m,{variant:"outline",onClick:()=>i(!o),className:"text-secondary-foreground hover:text-primary hover:bg-accent hover:border-primary border-border rounded-2xl w-12 h-12 p-0 transition-all duration-300",children:(0,a.jsx)(N.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{children:(0,a.jsx)("p",{children:"标签"})})]})})]})})}),f?(0,a.jsx)("div",{className:"fixed right-[10px] top-1/2 -translate-y-1/2 z-50 max-h-[calc(100vh-2rem)] overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-white/90 backdrop-blur-xl border border-border/30 rounded-3xl p-3 shadow-2xl shadow-black/10",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:_,className:"bg-warning hover:bg-warning/90 text-warning-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50 shadow-lg shadow-warning/25",disabled:A,children:(0,a.jsx)(k.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{side:"left",children:(0,a.jsx)("p",{children:"文本模式"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:E,className:"bg-primary hover:bg-primary/90 text-primary-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50 shadow-lg shadow-primary/25",disabled:A,children:A?(0,a.jsx)(w.A,{className:"w-5 h-5 animate-spin"}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})})})}),(0,a.jsx)(j,{side:"left",children:(0,a.jsx)("p",{children:A?"保存中...":"保存"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:()=>S(!1),className:"bg-secondary hover:bg-secondary/80 text-secondary-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50",disabled:A,children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})})}),(0,a.jsx)(j,{side:"left",children:(0,a.jsx)("p",{children:"取消"})})]})})]})})}):(0,a.jsx)("div",{className:"fixed right-[10px] top-1/2 -translate-y-1/2 z-50 max-h-[calc(100vh-2rem)] overflow-y-auto",children:(0,a.jsx)("div",{className:"bg-white/90 backdrop-blur-xl border border-border/30 rounded-3xl p-3 shadow-2xl shadow-black/10",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:T,className:"bg-success hover:bg-success/90 text-success-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50 shadow-lg shadow-success/25",disabled:A,children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{side:"left",children:(0,a.jsx)("p",{children:"导入"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:()=>S(!0),className:"bg-background hover:bg-accent text-foreground border border-border rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50",disabled:A,children:A?(0,a.jsx)(w.A,{className:"w-5 h-5 animate-spin"}):(0,a.jsx)(C.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{side:"left",children:(0,a.jsx)("p",{children:"修改"})})]})})]})})}),(0,a.jsx)("div",{className:"sm:hidden fixed bottom-4 left-4 right-4 z-50",children:(0,a.jsx)("div",{className:"bg-white/90 backdrop-blur-xl border border-border/30 rounded-3xl p-3 shadow-2xl shadow-black/10",children:(0,a.jsx)("div",{className:"flex justify-center gap-3",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:_,className:"bg-warning hover:bg-warning/90 text-warning-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50 shadow-lg shadow-warning/25",disabled:A,children:(0,a.jsx)(k.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{children:(0,a.jsx)("p",{children:"文本模式"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:E,className:"bg-primary hover:bg-primary/90 text-primary-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50 shadow-lg shadow-primary/25",disabled:A,children:A?(0,a.jsx)(w.A,{className:"w-5 h-5 animate-spin"}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})})})}),(0,a.jsx)(j,{children:(0,a.jsx)("p",{children:A?"保存中...":"保存"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:()=>S(!1),className:"bg-secondary hover:bg-secondary/80 text-secondary-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50",disabled:A,children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})})}),(0,a.jsx)(j,{children:(0,a.jsx)("p",{children:"取消"})})]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:T,className:"bg-success hover:bg-success/90 text-success-foreground rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50 shadow-lg shadow-success/25",disabled:A,children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{children:(0,a.jsx)("p",{children:"导入"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(g,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("button",{onClick:()=>S(!0),className:"bg-background hover:bg-accent text-foreground border border-border rounded-2xl w-11 h-11 flex items-center justify-center transition-all duration-300 active:scale-95 hover:scale-105 disabled:opacity-50",disabled:A,children:A?(0,a.jsx)(w.A,{className:"w-5 h-5 animate-spin"}):(0,a.jsx)(C.A,{className:"w-5 h-5"})})}),(0,a.jsx)(j,{children:(0,a.jsx)("p",{children:"修改"})})]})})]})})})}),o&&(0,a.jsx)(u,{className:"glass-effect border-0 rounded-3xl animated-element card-hover",children:(0,a.jsx)(h,{className:"p-8",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:R.map(e=>{let t=l.includes(e),r="无标签"===e?s.filter(e=>0===e.tags.length).length:s.filter(s=>s.tags.includes(e)).length;return(0,a.jsxs)(m,{variant:t?"default":"outline",size:"sm",onClick:()=>{t?d(l.filter(s=>s!==e)):d([...l,e])},className:"rounded-full px-5 py-2.5 text-sm font-medium animated-element transition-all duration-300 ".concat(t?"bg-primary text-primary-foreground border-0 scale-105 shadow-lg shadow-primary/25":"bg-accent hover:bg-accent/80 text-accent-foreground border border-border scale-100"),children:[e," (",r,")"]},e)})}),l.length>0&&(0,a.jsx)("div",{className:"pt-6 border-t border-border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"caption text-muted-foreground",children:["已选择 ",l.length," 个标签，匹配 ",c.length," 个站点"]}),(0,a.jsx)(m,{variant:"outline",size:"sm",onClick:()=>d([]),className:"border-border text-muted-foreground bg-background hover:bg-accent hover:text-accent-foreground rounded-2xl px-4 py-2",children:"清除"})]})})]})})})]})}let S=(0,l.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function E(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:i(S({variant:t}),s),...r})}let T=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:i("w-full caption-bottom text-sm",t),...r})})});T.displayName="Table";let _=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:i("[&_tr]:border-b",t),...r})});_.displayName="TableHeader";let R=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:i("[&_tr:last-child]:border-0",t),...r})});R.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:i("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let M=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:i("border-b data-[state=selected]:bg-muted",t),...r})});M.displayName="TableRow";let z=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:i("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});z.displayName="TableHead";let O=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:i("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});O.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:i("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption";var I=t(4869),L=t(1684),F=t(4213),D=t(4738),P=t(381);function U(e){let{sites:s,isEditMode:t,allTags:r,onSiteFieldChange:n,onAccessSite:l,onSSHAccess:d,onMySQLAccess:o,onShowProxyConfig:i,onAddTag:c}=e;return(0,a.jsx)(u,{className:"glass-effect border-0 rounded-3xl overflow-hidden card-hover",children:(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)(T,{children:[(0,a.jsx)(_,{className:"sticky top-0 z-10",children:(0,a.jsxs)(M,{className:"border-b border-border/50 bg-secondary/50 backdrop-blur-sm",children:[(0,a.jsx)(z,{className:"text-secondary-foreground font-medium py-8 px-10 w-60",children:"站点编号"}),(0,a.jsx)(z,{className:"text-secondary-foreground font-medium py-8 px-10 w-60",children:"站点名称"}),t&&(0,a.jsx)(z,{className:"text-secondary-foreground font-medium py-8 px-10",children:"MAC地址"}),(0,a.jsx)(z,{className:"text-secondary-foreground font-medium py-8 px-10",children:"密码"}),(0,a.jsx)(z,{className:"text-secondary-foreground font-medium py-8 px-10 w-80",children:"标签"}),(0,a.jsx)(z,{className:"text-secondary-foreground font-medium py-8 px-10 text-center",children:"操作"})]})}),(0,a.jsx)(R,{children:s.map((e,s)=>(0,a.jsxs)(M,{className:"border-b border-border/30 table-row-elevated transition-all duration-300 hover:bg-accent/30 ".concat(s%2==0?"bg-white/95":"bg-muted/20"),children:[(0,a.jsx)(O,{className:"py-8 px-10",children:t?(0,a.jsx)(x,{value:e.siteCode,onChange:s=>n(e.macAddress,"siteCode",s.target.value),className:"apple-input h-11 font-mono text-sm"}):(0,a.jsx)("span",{className:"font-mono text-sm font-medium",style:{color:"rgb(28 28 30)"},children:e.siteCode})}),(0,a.jsx)(O,{className:"py-8 px-10",children:t?(0,a.jsx)(x,{value:e.siteName,onChange:s=>n(e.macAddress,"siteName",s.target.value),className:"apple-input h-11 font-medium text-sm"}):(0,a.jsx)("span",{className:"font-medium",style:{color:"rgb(28 28 30)"},children:e.siteName})}),t&&(0,a.jsx)(O,{className:"py-8 px-10",children:(0,a.jsx)("span",{className:"font-mono text-sm",style:{color:"rgb(99 99 102)"},children:e.macAddress})}),(0,a.jsx)(O,{className:"py-8 px-10",children:t?(0,a.jsx)(x,{type:"text",value:e.password,onChange:s=>n(e.macAddress,"password",s.target.value),className:"apple-input h-11 text-sm",placeholder:"输入密码"}):(0,a.jsx)("span",{className:"text-sm font-mono font-normal",style:{color:"rgb(28 28 30)"},children:e.password||"未设置"})}),(0,a.jsx)(O,{className:"py-8 px-10",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:t?(0,a.jsxs)(a.Fragment,{children:[r.map(s=>{let t=e.tags.includes(s);return(0,a.jsx)(m,{variant:t?"default":"outline",size:"sm",onClick:()=>{t?n(e.macAddress,"tags",e.tags.filter(e=>e!==s)):n(e.macAddress,"tags",[...e.tags,s])},className:"apple-button rounded-full px-4 py-2 text-xs font-normal animated-element transition-all duration-300 ".concat(t?"bg-primary text-primary-foreground border-0 scale-105":"bg-accent hover:bg-accent/80 text-accent-foreground border border-border scale-100"),children:s},s)}),(0,a.jsxs)(m,{size:"sm",variant:"outline",onClick:()=>{let s=prompt("请输入新标签:");s&&c(e.macAddress,s)},className:"apple-button rounded-full px-4 py-2 text-xs border-2 border-dashed border-border text-muted-foreground bg-background hover:bg-accent hover:text-accent-foreground animated-element",children:[(0,a.jsx)(y.A,{className:"w-4 h-4 mr-1"}),"添加"]})]}):e.tags.map(e=>(0,a.jsx)(E,{className:"rounded-full px-4 py-2 text-xs font-normal border border-border/30 cursor-default transition-all duration-300",style:{backgroundColor:"rgb(248 248 250)",color:"rgb(28 28 30)"},children:e},e))})}),(0,a.jsx)(O,{className:"py-8 px-10 text-right",children:(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[!t&&(()=>{let s=e.configs.find(e=>e.name.includes("-5000")),t=e.configs.find(e=>e.name.endsWith("-22")),r=e.configs.find(e=>e.name.endsWith("-3306"));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m,{size:"sm",variant:"outline",disabled:!s,onClick:()=>s&&l(e),className:"ios-button text-foreground rounded-2xl px-3 py-2 text-xs animated-element",title:s?"访问站点":"访问站点 - 未配置网站端口(-5000)",children:(0,a.jsx)(I.A,{className:"w-4 h-4"})}),(0,a.jsx)(m,{size:"sm",variant:"outline",disabled:!t,onClick:()=>t&&d(e),className:"ios-button text-foreground rounded-2xl px-3 py-2 text-xs font-normal animated-element",title:t?"SSH连接":"SSH连接 - 未配置SSH端口(-22)",children:(0,a.jsx)(L.A,{className:"w-4 h-4"})}),(0,a.jsx)(m,{size:"sm",variant:"outline",disabled:!r,onClick:()=>r&&o(e),className:"ios-button text-foreground rounded-2xl px-3 py-2 text-xs font-normal animated-element",title:r?"MySQL连接":"MySQL连接 - 未配置MySQL端口(-3306)",children:(0,a.jsx)(F.A,{className:"w-4 h-4"})}),(0,a.jsx)(m,{size:"sm",variant:"outline",disabled:!1,onClick:()=>{console.log("BS访问: ".concat(e.siteName))},className:"ios-button text-foreground rounded-2xl px-3 py-2 text-xs font-normal animated-element",title:"BS平台",children:(0,a.jsx)(D.A,{className:"w-4 h-4"})})]})})(),t&&(0,a.jsxs)(m,{size:"sm",variant:"outline",onClick:()=>i(e),className:"ios-button text-foreground rounded-2xl px-4 py-2 text-xs font-normal animated-element",children:[(0,a.jsx)(P.A,{className:"w-4 h-4 mr-1"}),"端口配置"]})]})})]},e.macAddress))})]})})})}var W=t(2525);function B(e){let{showProxyConfig:s,setShowProxyConfig:t,onSave:n,allSites:l=[]}=e,[d,o]=(0,r.useState)([]);(0,r.useEffect)(()=>{s&&o([...s.configs])},[s]);let i=()=>{let e=18015,s=new Set;for(l.forEach(e=>{e.configs.forEach(e=>{e.bind_port>0&&s.add(e.bind_port)})}),d.forEach(e=>{e.bind_port>0&&s.add(e.bind_port)});s.has(e);)e++;return e},c=e=>{o(s=>s.filter((s,t)=>t!==e))},u=(e,s,t)=>{o(a=>a.map((a,r)=>r===e?{...a,[s]:t,bind_addr:"0.0.0.0"}:a))};return s?(0,a.jsx)("div",{className:"sticky top-4 z-20 glass-effect border-0 rounded-3xl animated-element card-hover bg-white/95 backdrop-blur-sm shadow-xl mb-6",children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center",children:(0,a.jsx)(P.A,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"title-3",children:"端口配置"}),(0,a.jsxs)("p",{className:"caption text-foreground",children:["站点: ",s.siteName," (",s.siteCode,")"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(m,{variant:"outline",onClick:()=>{t(null)},className:"border-border text-foreground bg-white/90 hover:bg-white hover:shadow-lg rounded-2xl px-6 py-3 animated-element backdrop-blur-sm",children:"取消"}),(0,a.jsx)(m,{onClick:()=>{s&&n(s,d.map(e=>{if(0===e.bind_port){let s=i();return console.log("自动分配端口: ".concat(e.name," -> ").concat(s)),{...e,bind_port:s}}return e})),t(null)},className:"button-primary animated-element font-semibold",children:"确认"})]})]}),(0,a.jsxs)(T,{className:"bg-white/70 rounded-2xl backdrop-blur-sm",children:[(0,a.jsx)(_,{children:(0,a.jsxs)(M,{className:"border-border",children:[(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"代理名称"}),(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"类型"}),(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"角色"}),(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"服务名"}),(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"密钥"}),(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"绑定端口"}),(0,a.jsx)(z,{className:"text-foreground font-semibold",children:"操作"})]})}),(0,a.jsx)(R,{children:d.map((e,s)=>(0,a.jsxs)(M,{className:"border-border hover:bg-white/80 transition-colors",children:[(0,a.jsx)(O,{children:(0,a.jsx)(x,{value:e.name,onChange:e=>u(s,"name",e.target.value),className:"bg-white/60 border-border rounded-xl"})}),(0,a.jsx)(O,{children:(0,a.jsx)(x,{value:e.type,onChange:e=>u(s,"type",e.target.value),className:"bg-white/60 border-border rounded-xl"})}),(0,a.jsx)(O,{children:(0,a.jsx)(x,{value:e.role,onChange:e=>u(s,"role",e.target.value),className:"bg-white/60 border-border rounded-xl"})}),(0,a.jsx)(O,{children:(0,a.jsx)(x,{value:e.server_name,onChange:e=>u(s,"server_name",e.target.value),className:"bg-white/60 border-border rounded-xl"})}),(0,a.jsx)(O,{children:(0,a.jsx)(x,{value:e.sk,onChange:e=>u(s,"sk",e.target.value),className:"bg-white/60 border-border rounded-xl"})}),(0,a.jsx)(O,{children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(x,{type:"number",value:e.bind_port,onChange:e=>u(s,"bind_port",parseInt(e.target.value)||0),placeholder:"输入0自动分配",className:"bg-white/60 border-border rounded-xl"}),0===e.bind_port&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"保存时自动分配端口"})]})}),(0,a.jsx)(O,{children:(0,a.jsx)(m,{variant:"destructive",size:"sm",onClick:()=>c(s),className:"rounded-xl",children:(0,a.jsx)(W.A,{className:"w-4 h-4"})})})]},s))})]}),(0,a.jsxs)(m,{onClick:()=>{let e={name:"",type:"stcp",role:"visitor",server_name:"",sk:(null==s?void 0:s.macAddress)||"",bind_addr:"0.0.0.0",bind_port:0};o(s=>[...s,e])},variant:"outline",className:"w-full border-dashed border-2 border-border text-foreground hover:bg-accent rounded-2xl py-4 animated-element",children:[(0,a.jsx)(y.A,{className:"w-5 h-5 mr-2"}),"新增端口配置"]})]})})}):null}var H=t(5452),V=t(4416);let Q=H.bL;H.l9;let J=H.ZL;H.bm;let q=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(H.hJ,{ref:s,className:i("fixed inset-0 z-50 bg-black/40 backdrop-blur-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 transition-all duration-300",t),...r})});q.displayName=H.hJ.displayName;let Y=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(J,{children:[(0,a.jsx)(q,{}),(0,a.jsxs)(H.UC,{ref:s,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-6 border border-border/50 bg-background/95 backdrop-blur-xl p-8 shadow-2xl shadow-black/20 duration-300 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-3xl",t),...n,children:[r,(0,a.jsxs)(H.bm,{className:"absolute right-6 top-6 rounded-xl p-2 opacity-70 ring-offset-background transition-all duration-300 hover:opacity-100 hover:bg-accent focus:outline-none focus:ring-2 focus:ring-primary/20 focus:ring-offset-2 disabled:pointer-events-none",children:[(0,a.jsx)(V.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});Y.displayName=H.UC.displayName;let G=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:i("flex flex-col space-y-3 text-center sm:text-left",s),...t})};G.displayName="DialogHeader";let X=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(H.hE,{ref:s,className:i("text-xl font-bold leading-tight tracking-tight text-foreground",t),...r})});X.displayName=H.hE.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(H.VY,{ref:s,className:i("text-sm text-muted-foreground",t),...r})}).displayName=H.VY.displayName;var Z=t(968);let K=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(Z.b,{ref:s,className:i(K(),t),...r})});$.displayName=Z.b.displayName;let ee=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:i("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...r})});ee.displayName="Textarea";var es=t(330),et=t(6474),ea=t(7863),er=t(5196);let en=es.bL;es.YJ;let el=es.WT,ed=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(es.l9,{ref:s,className:i("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,a.jsx)(es.In,{asChild:!0,children:(0,a.jsx)(et.A,{className:"h-4 w-4 opacity-50"})})]})});ed.displayName=es.l9.displayName;let eo=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(es.PP,{ref:s,className:i("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(ea.A,{className:"h-4 w-4"})})});eo.displayName=es.PP.displayName;let ei=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(es.wn,{ref:s,className:i("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(et.A,{className:"h-4 w-4"})})});ei.displayName=es.wn.displayName;let ec=r.forwardRef((e,s)=>{let{className:t,children:r,position:n="popper",...l}=e;return(0,a.jsx)(es.ZL,{children:(0,a.jsxs)(es.UC,{ref:s,className:i("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,a.jsx)(eo,{}),(0,a.jsx)(es.LM,{className:i("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(ei,{})]})})});ec.displayName=es.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(es.JU,{ref:s,className:i("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=es.JU.displayName;let em=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(es.q7,{ref:s,className:i("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(es.VF,{children:(0,a.jsx)(er.A,{className:"h-4 w-4"})})}),(0,a.jsx)(es.p4,{children:r})]})});em.displayName=es.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(es.wv,{ref:s,className:i("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=es.wv.displayName;let ex=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),eu=r.forwardRef((e,s)=>{let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:i(ex({variant:r}),t),...n})});eu.displayName="Alert",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:i("mb-1 font-medium leading-none tracking-tight",t),...r})}).displayName="AlertTitle";let eh=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:i("text-sm [&_p]:leading-relaxed",t),...r})});eh.displayName="AlertDescription";let ef=0,ep=new Map,eg=e=>{if(ep.has(e))return;let s=setTimeout(()=>{ep.delete(e),eN({type:"REMOVE_TOAST",toastId:e})},1e6);ep.set(e,s)},eb=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?eg(t):e.toasts.forEach(e=>{eg(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},ej=[],ev={toasts:[]};function eN(e){ev=eb(ev,e),ej.forEach(e=>{e(ev)})}function ey(e){let{...s}=e,t=(ef=(ef+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>eN({type:"DISMISS_TOAST",toastId:t});return eN({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>eN({type:"UPDATE_TOAST",toast:{...e,id:t}})}}var ew=t(9869),eC=t(5339),ek=t(1243),eA=t(7100);let eS=[{value:"unselected",label:"选择字段..."},{value:"siteCode",label:"站点编号"},{value:"siteName",label:"站点名称"},{value:"macAddress",label:"MAC地址"},{value:"password",label:"密码"},{value:"tags",label:"标签"},{value:"ignore",label:"忽略此列"}],eE=["macAddress"];function eT(e){let{showBatchImport:s,setShowBatchImport:t}=e,[n,l]=(0,r.useState)(""),[d,o]=(0,r.useState)({}),[i,c]=(0,r.useState)(!1),[x,u]=(0,r.useState)(!1),[h,f]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),{toast:b}=function(){let[e,s]=r.useState(ev);return r.useEffect(()=>(ej.push(s),()=>{let e=ej.indexOf(s);e>-1&&ej.splice(e,1)}),[e]),{...e,toast:ey,dismiss:e=>eN({type:"DISMISS_TOAST",toastId:e})}}(),{actions:j}=(0,eA.i)(),v=(0,r.useMemo)(()=>{if(!n.trim())return[];let e=n.trim().split("\n");if(0===e.length)return[];let s=" ",t=0;for(let a of["|","	"," "]){let r=e[0].split(a).length;if(r>1){let n=e.map(e=>e.split(a).length),l=n.reduce((e,s)=>e+s,0)/n.length;r>=t&&1>Math.abs(r-l)&&(s=a,t=r)}}return e.map(e=>e.split(s).map(e=>e.trim())).filter(e=>e.some(e=>e.length>0))},[n]),N=(0,r.useMemo)(()=>Math.max(0,...v.map(e=>e.length)),[v]),y=(0,r.useMemo)(()=>{if(0===N)return{};let e={},s=["siteName","siteCode","macAddress","password","tags"];for(let t=0;t<Math.min(N,s.length);t++)e[t]=s[t];for(let t=s.length;t<N;t++)e[t]="tags";return e},[N]),w=(0,r.useMemo)(()=>{let e={...y};return Object.entries(d).forEach(s=>{let[t,a]=s;a&&"unselected"!==a&&(e[parseInt(t)]=a)}),e},[y,d]),C=(0,r.useMemo)(()=>{let e=[],s=Object.values(w).filter(e=>e&&"ignore"!==e&&"unselected"!==e);for(let a of eE)if(!s.includes(a)){var t;let s=null===(t=eS.find(e=>e.value===a))||void 0===t?void 0:t.label;e.push("缺少必填字段：".concat(s))}let a=s.filter((e,t)=>s.indexOf(e)!==t);return a.length>0&&e.push("重复映射字段：".concat(a.join(", "))),e},[w]),k=(e,s)=>{o(t=>({...t,[e]:s}))},A=e=>{let s=Object.entries(w).filter(s=>{let[t,a]=s;return parseInt(t)!==e&&a&&"ignore"!==a&&"unselected"!==a&&"tags"!==a}).map(e=>{let[,s]=e;return s});return eS.filter(e=>"unselected"===e.value||"ignore"===e.value||"tags"===e.value||!s.includes(e.value))},S=()=>{let e=[],s=18015;for(let t of v)try{let a={};if(Object.entries(w).forEach(e=>{let[s,r]=e,n=t[parseInt(s)]||"";if("tags"===r){let e=a.tags||[],s=n?n.split(",").map(e=>e.trim()).filter(e=>e):[];a.tags=[...e,...s]}else r&&"ignore"!==r&&"unselected"!==r&&(a[r]=n)}),!a.macAddress)continue;let r=[{name:"E-".concat(a.macAddress,"-22"),type:"stcp",role:"visitor",server_name:"E-".concat(a.macAddress,"-22"),sk:a.macAddress,bind_addr:"0.0.0.0",bind_port:s++},{name:"E-".concat(a.macAddress,"-3306"),type:"stcp",role:"visitor",server_name:"E-".concat(a.macAddress,"-3306"),sk:a.macAddress,bind_addr:"0.0.0.0",bind_port:s++},{name:"E-".concat(a.macAddress,"-5000"),type:"stcp",role:"visitor",server_name:"E-".concat(a.macAddress,"-5000"),sk:a.macAddress,bind_addr:"0.0.0.0",bind_port:s++}],n={macAddress:a.macAddress,siteCode:a.siteCode,siteName:a.siteName,password:a.password||"",tags:a.tags||[],configs:r};e.push(n)}catch(e){console.warn("Failed to process row:",t,e)}return e},E=async()=>{if(C.length>0){b({title:"映射错误",description:C[0],variant:"destructive"});return}let e=S();if(0===e.length){b({title:"导入失败",description:"没有找到有效的站点数据",variant:"destructive"});return}c(!0);try{let s=await j.importSitesWithDuplicateCheck(e);s.duplicates.length>0?(f(s.duplicates),g(e),u(!0),c(!1)):(s.success>0&&b({title:"导入成功",description:"成功导入 ".concat(s.success," 个站点")}),L())}catch(e){b({title:"导入失败",description:e instanceof Error?e.message:"未知错误",variant:"destructive"}),c(!1)}},I=async e=>{u(!1),c(!0);try{let s=await j.importSitesWithOverwrite(p,e),t="";s.success>0&&(t+="新增 ".concat(s.success," 个站点")),s.overwritten>0&&(t+="".concat(t?"，":"","覆盖 ").concat(s.overwritten," 个站点")),t&&b({title:"导入完成",description:t}),s.errors.length>0&&b({title:"部分导入失败",description:s.errors.slice(0,3).join("; "),variant:"destructive"}),L()}catch(e){b({title:"导入失败",description:e instanceof Error?e.message:"未知错误",variant:"destructive"})}finally{c(!1)}},L=()=>{l(""),o({}),f([]),g([]),t(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Q,{open:s,onOpenChange:t,children:(0,a.jsxs)(Y,{className:"max-w-[90vw] w-[90%] max-h-[90vh]",children:[(0,a.jsx)(G,{children:(0,a.jsxs)(X,{className:"flex items-center gap-2",children:[(0,a.jsx)(ew.A,{className:"h-5 w-5"}),"批量导入站点"]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)($,{htmlFor:"importData",className:"text-sm font-semibold",children:"导入数据"}),(0,a.jsx)(m,{variant:"outline",size:"sm",onClick:()=>{l("苏州辐射站|DC001|E721EE345A01|pass123|测试,在线,重要\n南京监测点|DC002|E721EE345A02|pass456|生产,稳定\n无锡数据中心|DC003|E721EE345A03|pass789|重要,维护,关键,核心"),o({}),b({title:"示例数据已加载",description:"请为每列选择对应的字段"})},className:"text-xs",children:"加载示例"})]}),(0,a.jsx)(ee,{id:"importData",value:n,onChange:e=>l(e.target.value),placeholder:"请粘贴数据，每行一个站点，支持 竖线 制表符 空格 分隔，标签内用逗号分隔...",rows:6,className:"apple-input resize-none font-mono text-sm"})]}),v.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)($,{className:"text-sm font-semibold",children:"列映射"}),(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsx)("div",{className:"max-h-80 overflow-y-auto",children:(0,a.jsxs)(T,{children:[(0,a.jsx)(_,{children:(0,a.jsx)(M,{children:Array.from({length:N},(e,s)=>(0,a.jsx)(z,{className:"min-w-[150px]",children:(0,a.jsxs)(en,{value:w[s]||"unselected",onValueChange:e=>k(s,e),children:[(0,a.jsx)(ed,{className:"h-8 text-xs",children:(0,a.jsx)(el,{placeholder:"选择字段"})}),(0,a.jsx)(ec,{children:A(s).map(e=>(0,a.jsx)(em,{value:e.value,children:e.label},e.value))})]})},s))})}),(0,a.jsx)(R,{children:v.map((e,s)=>(0,a.jsx)(M,{children:Array.from({length:N},(s,t)=>(0,a.jsx)(O,{className:"text-xs font-mono",children:e[t]||""},t))},s))})]})})})]}),C.length>0&&(0,a.jsxs)(eu,{variant:"destructive",children:[(0,a.jsx)(eC.A,{className:"h-4 w-4"}),(0,a.jsx)(eh,{children:(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1",children:C.map((e,s)=>(0,a.jsx)("li",{className:"text-sm",children:e},s))})})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,a.jsx)(m,{variant:"outline",onClick:()=>t(!1),className:"flex-1",children:"取消"}),(0,a.jsx)(m,{onClick:E,disabled:!v.length||C.length>0||i,className:"flex-1",children:i?"导入中...":"导入 ".concat(v.length," 个站点")})]})]})]})}),(0,a.jsx)(Q,{open:x,onOpenChange:u,children:(0,a.jsxs)(Y,{className:"max-w-md",children:[(0,a.jsx)(G,{children:(0,a.jsxs)(X,{className:"flex items-center gap-2",children:[(0,a.jsx)(ek.A,{className:"h-5 w-5 text-amber-500"}),"发现重复数据"]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(eu,{children:[(0,a.jsx)(eC.A,{className:"h-4 w-4"}),(0,a.jsxs)(eh,{children:["发现 ",(0,a.jsx)("span",{className:"font-semibold",children:h.length})," 个重复的MAC地址，请选择处理方式："]})]}),h.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)($,{className:"text-sm font-medium",children:"重复的MAC地址："}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:h.map((e,s)=>(0,a.jsxs)("div",{className:"text-xs font-mono bg-gray-50 px-2 py-1 rounded",children:[e.macAddress," ",e.siteName&&"(".concat(e.siteName,")")]},s))})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,a.jsx)(m,{variant:"outline",onClick:()=>I(!1),disabled:i,className:"flex-1",children:"跳过重复数据"}),(0,a.jsx)(m,{onClick:()=>I(!0),disabled:i,className:"flex-1",children:"覆盖全部重复"})]})]})]})})]})}var e_=t(3904),eR=t(6671);function eM(e){let{showConfigEditor:s,setShowConfigEditor:t}=e,[n,l]=(0,r.useState)("");(0,r.useEffect)(()=>{s&&d()},[s]);let d=()=>{fetch("/api/config",{credentials:"include"}).then(e=>e.text()).then(e=>{l(e)}).catch(e=>{eR.oR.error("Get configure content from frpc failed!")})};return(0,a.jsx)(Q,{open:s,onOpenChange:t,children:(0,a.jsxs)(Y,{className:"sm:max-w-4xl max-h-[80vh]",children:[(0,a.jsx)(G,{children:(0,a.jsx)(X,{children:"修改配置文件"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsxs)(m,{variant:"outline",onClick:d,children:[(0,a.jsx)(e_.A,{className:"w-4 h-4 mr-2"}),"刷新"]}),(0,a.jsx)(m,{onClick:()=>{if(""===n){eR.oR.error("Configure content can not be empty!");return}fetch("/api/config",{credentials:"include",method:"PUT",body:n}).then(()=>{fetch("/api/reload",{credentials:"include"}).then(()=>{eR.oR.success("Success"),t(!1)}).catch(e=>{eR.oR.error("Reload frpc configure file error, "+e)})}).catch(e=>{eR.oR.error("Put config to frpc and hot reload failed!")})},children:"上传"})]}),(0,a.jsx)(ee,{value:n,onChange:e=>l(e.target.value),placeholder:"frpc configure file, can not be empty...",rows:20,className:"font-mono text-sm text-black"})]})]})})}function ez(){let{state:e,actions:s}=(0,eA.i)(),[t,n]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),[o,i]=(0,r.useState)(!1),[c,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{s.loadSites()},[]);let{sites:x,filteredSites:u,loading:h,error:f,editMode:p,searchTerm:g,selectedTags:b,allTags:j,lastSyncTime:v}=e,N=async(e,t,a)=>{try{await s.updateSite(e,{[t]:a},!0)}catch(e){console.error("Failed to update site:",e)}},y=async(e,t)=>{try{await s.updateSite(e.macAddress,{configs:t}),m({...e,configs:t})}catch(e){console.error("Failed to save proxy config:",e)}},w=async(e,t)=>{if(t.trim()){let a=x.find(s=>s.macAddress===e);if(a&&!a.tags.includes(t.trim()))try{await s.updateSite(e,{tags:[...a.tags,t.trim()]},!0)}catch(e){console.error("Failed to add tag:",e)}}},C=async()=>{try{await s.saveSites(),s.setEditMode(!1)}catch(e){console.error("Failed to save changes:",e)}};return f?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4",children:(0,a.jsx)("div",{className:"max-w-[90rem] mx-auto space-y-8",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"连接失败"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:f})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 pb-20 sm:pb-4",children:(0,a.jsxs)("div",{className:"max-w-[90rem] mx-auto space-y-8",children:[(0,a.jsx)(A,{sites:x,searchTerm:g,setSearchTerm:s.setSearchTerm,selectedTags:b,setSelectedTags:s.setSelectedTags,showTagFilter:t,setShowTagFilter:n,filteredSites:u,editMode:p,loading:h,onEditModeChange:s.setEditMode,onSaveChanges:C,onShowBatchImport:()=>d(!0),onShowConfigEditor:()=>i(!0)}),(0,a.jsx)(B,{showProxyConfig:c,setShowProxyConfig:m,onSave:y,allSites:x}),(0,a.jsx)(U,{sites:u,isEditMode:p,allTags:j,onSiteFieldChange:N,onAccessSite:e=>{let s=e.configs.find(e=>e.name.includes("-5000"));if(s){let t=window.location.hostname,a="http://".concat(t,":").concat(s.bind_port),r="".concat(a,"?site=").concat(encodeURIComponent(e.siteCode),".").concat(encodeURIComponent(e.siteName));window.open(r,"_blank")}},onSSHAccess:e=>{let s=e.configs.find(e=>e.name.endsWith("-22")),t=e.configs.find(e=>e.name.endsWith("-3306"));if(s&&t){let s=window.location.hostname,a="".concat(e.siteCode,".").concat(e.siteName),r='xshell -newtab "'.concat(a,'" ssh forlinx@').concat(s,":").concat(t.bind_port);navigator.clipboard.writeText(r);let n=document.createElement("div");n.textContent="SSH命令已复制 (标签: ".concat(a,")"),n.style.cssText="\n        position: fixed; top: 20px; right: 20px; z-index: 9999;\n        background: rgba(0, 0, 0, 0.8); color: white; padding: 12px 16px;\n        border-radius: 8px; font-size: 14px; max-width: 400px;\n        animation: fadeInOut 3s forwards;\n      ",document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}else{let e=document.createElement("div"),a="配置不完整：";s||(a+="未找到SSH端口配置（-22）"),t||(a+=(s?"":"，")+"未找到MySQL端口配置（-3306）"),e.textContent=a,e.style.cssText="\n        position: fixed; top: 20px; right: 20px; z-index: 9999;\n        background: rgba(220, 38, 38, 0.9); color: white; padding: 12px 16px;\n        border-radius: 8px; font-size: 14px; max-width: 400px;\n        animation: fadeInOut 3s forwards;\n      ",document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}},onMySQLAccess:e=>{let s=e.configs.find(e=>e.name.endsWith("-3306"));if(s){let t=window.location.hostname,a="".concat(e.siteCode,".").concat(e.siteName),r="mysql://root:Sun%40123456@".concat(t,":").concat(s.bind_port,"/");navigator.clipboard.writeText(r);let n=document.createElement("div");n.textContent="MySQL连接信息已复制 (".concat(a,")"),n.style.cssText="\n        position: fixed; top: 20px; right: 20px; z-index: 9999;\n        background: rgba(0, 0, 0, 0.8); color: white; padding: 12px 16px;\n        border-radius: 8px; font-size: 14px; max-width: 400px;\n        animation: fadeInOut 3s forwards;\n      ",document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}else{let e=document.createElement("div");e.textContent="未找到MySQL端口配置（后缀-3306）",e.style.cssText="\n        position: fixed; top: 20px; right: 20px; z-index: 9999;\n        background: rgba(220, 38, 38, 0.9); color: white; padding: 12px 16px;\n        border-radius: 8px; font-size: 14px; max-width: 400px;\n        animation: fadeInOut 3s forwards;\n      ",document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}},onShowProxyConfig:e=>{m(e)},onAddTag:w}),(0,a.jsx)(eT,{showBatchImport:l,setShowBatchImport:d}),(0,a.jsx)(eM,{showConfigEditor:o,setShowConfigEditor:i})]})})}},4751:(e,s,t)=>{Promise.resolve().then(t.bind(t,3713))}},e=>{var s=s=>e(e.s=s);e.O(0,[671,133,100,441,684,358],()=>s(4751)),_N_E=e.O()}]);